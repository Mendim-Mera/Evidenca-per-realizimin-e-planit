
<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Evidenca për realizimin e planit 2024 - 2025</title>
  <style>
        body {
            font-family: Times New Roman;
            margin: 0px;
            background-color: lightblue;
            color: #333;
        }
        h3 {
            text-align: center;
            color: blue;
        }
        form {
            background-color: moccasin;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
	    font-family: Times New Roman;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
	    
	    font-family: Times New Roman;
        }
        input, select, button {
            width: calc(100% - 0px);
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .row {
            display: flex;
            gap: 20px;
            align-items: center;
	    width: calc(96% - 0px);
	    
        }
        .row > div {
            flex: 1;
	    
        }
        .row input {
            margin-top: 0;
	    
        }
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
	    font-family: Times New Roman;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 20px;
            padding: 10px;
            width: 100%;
        }
        button:hover {
            background-color: #45a049;
        }
        .signature-pad {
            margin-top: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        canvas {
            width: 100%;
            height: 150px;
            border-radius: 4px;
            touch-action: none; /* Ndalo zoom-in në telefon */
	    background-color: lightyellow;
        }
	

	table {
            width: 100%;
            margin-top: 2px;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 6px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        td input[type="text"] {
            width: calc(100% - 0px); /* Llogarit gjerësinë duke marrë parasysh padding */
            margin: 0;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 1px;
            box-sizing: border-box; /* Siguron që padding dhe border të përfshihen në gjerësinë totale */
        }
		td input[type="number"] {
    		width: 100%;
   		margin: 0;
    		padding: 6px;
    		border: 1px solid #ccc;
    		border-radius: 1px;
    		box-sizing: border-box;
       }
	td input[type="option"] {
    		width: 100%;
   		margin: 0;
    		padding: 6px;
    		border: 1px solid #ccc;
    		border-radius: 1px;
    		box-sizing: border-box;
       }

        .delete-button {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 2px 4px;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-button:hover {
            background-color: #cc0000;
        }
	.error-message {
            color: red;
            font-size: 14px;
            margin-top: 5px;
        }



    </style>

</head>
<body>
<h3>REALIZIMI I PLANIT</h3>
<form id="planForm">
  <label>Mësuesi Kujdestar</label>
  <div style="display: flex; gap: 10px;">
    <input type="text" name="emri" placeholder="Emri" required>
    <input type="text" name="mbiemri" placeholder="Mbiemri" required>
  </div>

  <label>Lëndët</label>
  <table id="planTable">
    <thead>
      <tr>
        <th>Klasa</th>
        <th>Lënda</th>
        <th>Plan</th>
        <th>Fakt</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <select name="klasa[]" required>
            <option value="" disabled selected>Zgjidh klasen nga lista e meposhtme. Zgjidh klasen nga lista e meposhtme.</option>
            <option value="10-A">10-A</option><option value="10-B">10-B</option><option value="10-C">10-C</option><option value="10-D">10-D</option><option value="10-E">10-E</option><option value="10-F">10-F</option><option value="10-G">10-G</option><option value="10-H">10-H</option><option value="10-I">10-I</option><option value="11-A">11-A</option><option value="11-B">11-B</option><option value="11-C">11-C</option><option value="11-D">11-D</option><option value="11-E">11-E</option><option value="11-F">11-F</option><option value="11-G">11-G</option><option value="11-H">11-H</option><option value="12-A">12-A</option><option value="12-B">12-B</option><option value="12-C">12-C</option><option value="12-D">12-D</option><option value="12-E">12-E</option><option value="12-F">12-F</option><option value="12-G">12-G</option>    <option value="10-A(KP)">10-A(KP)</option>
    <option value="10-B(KP)">10-B(KP)</option>
    <option value="10-C(KP)">10-C(KP)</option>
    <option value="11-A(KP)">11-A(KP)</option>
    <option value="11-B(KP)">11-B(KP)</option>
    <option value="11-C(KP)">11-C(KP)</option>
    <option value="12-A(KP)">12-A(KP)</option>
    <option value="12-B(KP)">12-B(KP)</option>
    <option value="13-A(KP)">13-A(KP)</option>
    <option value="13-B(KP)">13-B(KP)</option>

          </select>
        </td>
        <td><input type="text" name="lenda[]" required></td>
        <td><input type="number" name="plan[]" required></td>
        <td><input type="number" name="fakt[]" required></td>
        <td><button type="button" class="delete-button" onclick="deleteRow(this)">Hiq</button></td>
      </tr>
    </tbody>
  </table>
  <button type="button" onclick="addRow()" style="margin-top:10px; background-color: lightblue;">Shto lëndë</button>
  <label for="firma">Firma:</label>
  <div class="signature-pad">
    <canvas id="signatureCanvas"></canvas>
  </div>
  <button type="button" onclick="clearSignature()">Fshij firmën</button>
  <input type="hidden" id="firma" name="firma">
  <button type="submit" style="background-color: blue; color: white;">Dërgo</button>
</form>
<script>
const klasat = `<option value="10-A">10-A</option><option value="10-B">10-B</option><option value="10-C">10-C</option><option value="10-D">10-D</option><option value="10-E">10-E</option><option value="10-F">10-F</option><option value="10-G">10-G</option><option value="10-H">10-H</option><option value="10-I">10-I</option><option value="11-A">11-A</option><option value="11-B">11-B</option><option value="11-C">11-C</option><option value="11-D">11-D</option><option value="11-E">11-E</option><option value="11-F">11-F</option><option value="11-G">11-G</option><option value="11-H">11-H</option><option value="12-A">12-A</option><option value="12-B">12-B</option><option value="12-C">12-C</option><option value="12-D">12-D</option><option value="12-E">12-E</option><option value="12-F">12-F</option><option value="12-G">12-G</option>    <option value="10-A(KP)">10-A(KP)</option>
    <option value="10-B(KP)">10-B(KP)</option>
    <option value="10-C(KP)">10-C(KP)</option>
    <option value="11-A(KP)">11-A(KP)</option>
    <option value="11-B(KP)">11-B(KP)</option>
    <option value="11-C(KP)">11-C(KP)</option>
    <option value="12-A(KP)">12-A(KP)</option>
    <option value="12-B(KP)">12-B(KP)</option>
    <option value="13-A(KP)">13-A(KP)</option>
    <option value="13-B(KP)">13-B(KP)</option>
`;
function addRow() {
  const tbody = document.querySelector('#planTable tbody');
  const row = document.createElement('tr');
  row.innerHTML = `
    <td><select name="klasa[]" required><option value="" disabled selected>Zgjidh klasen nga lista e meposhtme. Zgjidh klasen nga lista e meposhtme.</option>${klasat}</select></td>
    <td><input type="text" name="lenda[]" required></td>
    <td><input type="number" name="plan[]" required></td>
    <td><input type="number" name="fakt[]" required></td>
    <td><button type="button" class="delete-button" onclick="deleteRow(this)">Hiq</button></td>`;
  tbody.appendChild(row);
}
function deleteRow(btn) {
  btn.closest('tr').remove();
}
function clearSignature() {
  const canvas = document.getElementById('signatureCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  document.getElementById('firma').value = '';
}
function captureSignature() {
  const canvas = document.getElementById('signatureCanvas');
  const dataURL = canvas.toDataURL();
  document.getElementById('firma').value = dataURL;
}
const canvas = document.getElementById('signatureCanvas');
const ctx = canvas.getContext('2d');
let isDrawing = false;
function getCanvasCoordinates(event) {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;
  let x, y;
  if (event.touches) {
    x = (event.touches[0].clientX - rect.left) * scaleX;
    y = (event.touches[0].clientY - rect.top) * scaleY;
  } else {
    x = (event.clientX - rect.left) * scaleX;
    y = (event.clientY - rect.top) * scaleY;
  }
  return { x, y };
}
canvas.addEventListener('mousedown', e => {
  isDrawing = true;
  const { x, y } = getCanvasCoordinates(e);
  ctx.beginPath();
  ctx.moveTo(x, y);
});
canvas.addEventListener('mousemove', e => {
  if (isDrawing) {
    const { x, y } = getCanvasCoordinates(e);
    ctx.lineTo(x, y);
    ctx.stroke();
  }
});
canvas.addEventListener('mouseup', () => {
  isDrawing = false;
  captureSignature();
});
canvas.addEventListener('mouseleave', () => isDrawing = false);
canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  isDrawing = true;
  const { x, y } = getCanvasCoordinates(e);
  ctx.beginPath();
  ctx.moveTo(x, y);
});
canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  if (isDrawing) {
    const { x, y } = getCanvasCoordinates(e);
    ctx.lineTo(x, y);
    ctx.stroke();
  }
});
canvas.addEventListener('touchend', () => {
  isDrawing = false;
  captureSignature();
});
document.getElementById('planForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const submitButton = e.target.querySelector('button[type="submit"]');
  submitButton.textContent = 'Po kontrolloj...';
  submitButton.disabled = true;
  const firma = document.getElementById('firma').value;
  if (!firma) {
    alert('Ju lutem, vendosni firmën tuaj!');
    submitButton.textContent = 'Dërgo';
    submitButton.disabled = false;
    return;
  }
  const emri = e.target.emri.value.trim();
  const mbiemri = e.target.mbiemri.value.trim();
  const lendet = [...e.target.querySelectorAll('input[name="lenda[]"]')].map(el => el.value.trim());
  const klasat = [...e.target.querySelectorAll('select[name="klasa[]"]')].map(el => el.value.trim());
  const planet = [...e.target.querySelectorAll('input[name="plan[]"]')].map(el => el.value.trim());
  const faktet = [...e.target.querySelectorAll('input[name="fakt[]"]')].map(el => el.value.trim());
  const rreshta = lendet.map((l, i) => `• ${l} | Klasa: ${klasat[i]} | Plan: ${planet[i]} | Fakt: ${faktet[i]}`).join('\n');
  const data = {
    rows: [{
      cells: [
        { column: "Emri", value: emri },
        { column: "Mbiemri", value: mbiemri },
        { column: "Lendet", value: rreshta },
        { column: "Firma", value: firma }
      ]
    }]
  };
  const response = await fetch("https://coda.io/apis/v1/docs/DJONJb548H/tables/Realizimi%20i%20planit/rows", {
    method: "POST",
    headers: {
      "Authorization": "Bearer b935802a-f8e5-4172-a38f-4314d5d38a92",
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  });
  if (response.ok) {
    alert("Të dhënat u dërguan me sukses!");
    e.target.reset();
    clearSignature();
    window.location.href = 'dalja.html';
  } else {
    const error = await response.json();
    alert("Gabim gjatë dërgimit:\n" + error.message);
  }
  submitButton.textContent = 'Dërgo';
  submitButton.disabled = false;
});
</script>
</body>
</html>
